#!/bin/bash

# this command should not be used on virtual interfaces

show_help() {
	echo -e "Resets and spoofs interface.\nThis command should not be used on virtual interfaces!\n  Usage: ifreset <interface>"
	exit
}

for cvar in $@; do
	if [[ $cvar == "-h" || $cvar == "-help" || $cvar == "--help" ]]; then
		show_help
	fi
done

if [[ -z $@ ]]; then
	show_help
else
	echo "Resetting & spoofing $@ ..."

	phy="phy$(echo $@ | sed -e s/^[a-z]*//)"

	# reset
	iw dev $@ del &> /dev/null
	iw dev $@mon del &> /dev/null
	iw phy $phy interface add $@ type managed
	rfkill unblock wifi

	# spoof
	ifconfig $@ down
	macchanger -rb $@ &> /dev/null
	ifconfig $@ up

	# check
	macchanger $@
fi
